{% extends "base.html" %}
{% load static %}


{% block title %}{{ book.title }} - Detalle{% endblock %}


{% block breadcrumbs %}
<div class="breadcrumb-container fade-in-up mb-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'home' %}" class="text-decoration-none">
                    <i class="bi bi-house-door-fill"></i> Inicio
                </a>
            </li>
            <li class="breadcrumb-separator mx-2">‚Ä∫</li>
            <li class="breadcrumb-item">
                <a href="{% url 'book_list' %}" class="text-decoration-none">
                    <i class="bi bi-book-half"></i> Cat√°logo
                </a>
            </li>
            <li class="breadcrumb-separator mx-2">‚Ä∫</li>
            <li class="breadcrumb-item active" aria-current="page">
                {{ book.title|truncatewords:5 }}
            </li>
        </ol>
    </nav>
</div>
{% endblock %}


{% block content %}
<div class="container py-5 fade-in-up">
    <div class="row align-items-start g-4">
        <!-- üìò Imagen del libro -->
        <div class="col-md-4 text-center" data-aos="fade-right">
            <div class="book-image-container position-relative">
                <img src="{{ book.image_url|default:'https://placehold.co/300x450?text=Sin+Imagen' }}" 
                     alt="Portada de {{ book.title }}" 
                     class="img-fluid rounded-3 shadow-sm book-cover"
                     onerror="this.onerror=null;this.src='https://placehold.co/300x450?text=Sin+Imagen';">


                <!-- Badge -->
                <div class="book-badge">
                    <span class="badge bg-dark text-white">
                        <i class="bi bi-check-circle"></i> Disponible
                    </span>
                </div>
            </div>
        </div>


        <!-- üìÑ Detalles del libro -->
        <div class="col-md-8" data-aos="fade-left">
            <h1 class="fw-bold mb-3 book-title">{{ book.title }}</h1>


            <div class="book-meta mb-4">
                <div class="meta-item"><i class="bi bi-person"></i><span>Autor(es):</span> {{ book.authors }}</div>
                <div class="meta-item"><i class="bi bi-bookmark"></i><span>G√©nero:</span> {{ book.genre }}</div>
                <div class="meta-item"><i class="bi bi-calendar"></i><span>A√±o:</span> {{ book.publication_date }}</div>
                <div class="meta-item"><i class="bi bi-people"></i><span>Grupo edad:</span> {{ book.dominant_age_group|default:"No especificado" }}</div>
            </div>


            <!-- üí∞ Precio -->
            <div class="price-section mb-3">
                <h3 class="price-amount mb-0">
                    {% if book.precio %}
                        ${{ book.precio|floatformat:0 }}
                    {% else %}
                        Precio no disponible
                    {% endif %}
                </h3>
            </div>


            <!-- ‚≠ê Calificaci√≥n -->
            <div class="rating-section mb-4">
                <div class="d-flex align-items-center gap-2">
                    <span class="rating-stars">
                        {% if book.average_rating %}
                            ‚≠ê {{ book.average_rating|floatformat:2 }} / 5.0
                        {% else %}
                            Sin calificaci√≥n
                        {% endif %}
                    </span>
                    <span class="text-muted small">
                        ({{ book.ratings_count|default:"0" }} calificaciones)
                    </span>
                </div>
            </div>


            <!-- üìú Descripci√≥n -->
            <div class="book-description mb-4">
                <h5><i class="bi bi-card-text"></i> Descripci√≥n</h5>
                <p>{{ book.description|default:"No hay descripci√≥n disponible para este libro." }}</p>
            </div>


            <!-- üõí Botones principales -->
            <div class="action-buttons d-flex flex-wrap gap-3 mt-4">
                <form action="{% url 'add_to_cart' book.id %}" method="post" class="flex-fill">
                    {% csrf_token %}
                    <button class="btn btn-outline btn-lg w-100">
                        <i class="bi bi-cart-plus"></i> Agregar al carrito
                    </button>
                </form>


                <form action="{% url 'buy_now' book.id %}" method="post" class="flex-fill">
                    {% csrf_token %}
                    <button class="btn btn-main btn-lg w-100">
                        <i class="bi bi-lightning-fill"></i> Comprar ahora
                    </button>
                </form>
            </div>


            <!-- ‚ù§Ô∏è Botones secundarios -->
            <!-- ‚ù§Ô∏è Botones secundarios -->
<div class="secondary-actions d-flex gap-2 mt-3">
    <a href="{% url 'toggle_favorite' book.id %}" class="btn btn-outline btn-small">
        <i class="bi bi-heart-fill"></i> Agregar a Favoritos
    </a>
    <button class="btn btn-outline btn-small">
        <i class="bi bi-share"></i> Compartir
    </button>
</div>



    <!-- üî∏ Separador -->
    <hr class="divider-custom my-5">


    <!-- üìö Libros relacionados -->
    <div class="related-books-section" data-aos="fade-up">
        <h3 class="fw-bold text-center mb-2">
            <i class="bi bi-stars"></i> Libros relacionados
        </h3>
        <p class="text-center text-muted mb-4">
            Descubre m√°s libros que te podr√≠an interesar
        </p>
        <div class="alert alert-info text-center">
            <i class="bi bi-clock-history me-2"></i>
            Pr√≥ximamente recomendaciones personalizadas basadas en tus intereses
        </div>
    </div>
</div>


<style>
/* üß± ESTRUCTURA DEL DETALLE (Monocrom√°tico) */
.book-cover {
    border: 1px solid var(--light-gray);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.book-cover:hover {
    transform: scale(1.03);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}
.book-badge {
    position: absolute;
    top: 12px;
    right: 12px;
}
.book-title {
    color: var(--black);
    font-size: 2rem;
    letter-spacing: -0.01em;
}
.book-meta {
    background: var(--extra-light-gray);
    padding: 18px;
    border-radius: 12px;
    border: 1px solid var(--light-gray);
}
.book-meta .meta-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.95rem;
    color: var(--medium-gray);
    padding: 5px 0;
}


/* üí∞ PRECIO - DESTACADO */
.price-section {
    background: var(--white);
    border: 3px solid var(--black);
    padding: 20px;
    border-radius: 12px;
    text-align: left;
}
.price-amount {
    color: var(--black);
    font-size: 2.5rem;
    font-weight: 700;
    letter-spacing: -0.02em;
}


/* ‚≠ê RATING - DISCRETO */
.rating-section {
    padding: 12px 0;
}
.rating-stars {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--black);
}


.book-description {
    background: var(--extra-light-gray);
    padding: 20px;
    border-radius: 12px;
    border-left: 4px solid var(--medium-gray);
}
.book-description h5 {
    font-weight: 600;
    color: var(--black);
}
.book-description p {
    color: var(--medium-gray);
}
.divider-custom {
    border: none;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--medium-gray), transparent);
}
.related-books-section h3 {
    color: var(--black);
}
.related-books-section .alert {
    border: 2px dashed var(--medium-gray);
    background: var(--extra-light-gray);
    color: var(--black);
    border-radius: 12px;
}
.secondary-actions .btn:hover {
    transform: translateY(-2px);
}
@media (max-width: 768px) {
    .book-title { font-size: 1.6rem; }
    .price-amount { font-size: 2rem; }
    .action-buttons { flex-direction: column; }
}
</style>
{% endblock %}
