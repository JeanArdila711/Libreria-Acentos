<!DOCTYPE html>
<html lang="es">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ app_name }}{% endblock %}</title>

    <!-- Bootstrap y animaciones -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">


    <style>
    :root {
        --primary:#343537;
        --primary-600:#343537;
        --accent:#2D9CDB;
        --bg:#F5F7FB;
        --card:#FFFFFF;
        --text:#1F2937;
        --muted:#6B7280;
        --border:#E5E7EB;
        --danger:#E76F51;
    }

    body {
        font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
        margin: 0;
        padding: 0;
        background-color: var(--bg);
        color: var(--text);
        min-height: 100vh;
    }

    /* Header */
    header {
        background: linear-gradient(90deg,var(--primary),var(--primary-600));
        color: white;
        padding: 0.5rem 0;
        text-align: center;
        box-shadow: 0 2px 8px rgba(11,61,145,0.25);
    }
    h1.app-title { margin: 0; font-size: 1.8rem; letter-spacing: .5px; font-weight: 700; }

    /* Barra superior */
    .auth-top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        padding: 8px 30px;
        background-color: var(--primary);
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .btn-auth {
        font-weight: 600;
        padding: 8px 18px;
        border-radius: 12px;
        text-decoration: none;
        min-width: 100px;
        text-align: center;
        cursor: pointer;
        display: inline-block;
        border: 2px solid white;
        background-color: white !important;
        color: var(--primary) !important;
    }
    .btn-auth:hover {
        background-color: white !important;
        color: var(--primary) !important;
        border: 2px solid white !important;
    }

    /* Botón Carrito */
    .btn-light {
        font-weight: 600;
        background-color: white;
        color: var(--primary);
        border: 2px solid var(--primary);
        border-radius: 12px;
        transition: all 0.3s ease;
    }
    .btn-light:hover {
        background-color: var(--primary);
        color: white;
        transform: scale(1.05);
    }

    /* Contenido principal */
    .main-content-wrapper {
        display: flex;
        flex: 1;
        width: 96%;
        max-width: 1400px;
        margin: 20px auto;
        gap: 18px;
    }
    .content {
        flex: 4;
        background-color: var(--card);
        padding: 22px;
        border-radius: 10px;
        border:1px solid var(--border);
        box-shadow: 0 6px 16px rgba(17,24,39,0.06);
    }

    footer {
        text-align: center;
        padding: 18px;
        margin-top: auto;
        background-color: var(--primary-600);
        color: white;
        border-top: 1px solid var(--primary);
    }
    </style>
</head>

<body>
    {% if messages %}
    <div class="container mt-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Header -->
    <header>
        <div class="logo-container" style="display:flex; align-items:center; gap:15px; margin-top: 5px;">
            <img src="{% static 'img/Logo.png' %}" 
                alt="Biblioteca Acentos"
                style="max-height:40px; width:auto; object-fit:contain; border-radius:8px; padding-left:5px;">
            <h1 class="app-title">{{ app_name }}</h1>
        </div>
    </header>

    <!-- Barra superior -->
    <div class="auth-top-bar">
        {% if user.is_authenticated %}
            <div class="text-white fw-semibold">
                👋 Hola, {{ user.first_name|default:user.username }}
            </div>
        {% else %}
            <div>
                <a href="{% url 'login' %}" class="btn btn-auth btn-login me-2">Login</a>
                <a href="{% url 'signup' %}" class="btn btn-auth btn-signup">Sign Up</a>
            </div>
        {% endif %}
    </div>

    <!-- Navbar con menú hamburguesa -->
    <nav class="d-flex justify-content-between align-items-center px-3" style="background-color: var(--primary-600);">
        <!-- Botón hamburguesa -->
        <button class="btn text-white fs-4" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuLateral" aria-controls="menuLateral">
            <i class="bi bi-list"></i>
        </button>

        <!-- Nombre del sitio -->
        <div>
            <a href="{% url 'home' %}" class="text-white text-decoration-none fw-bold fs-5">Biblioteca Acentos</a>
        </div>

        <!-- Carrito -->
        <div class="position-relative">
            <a href="{% url 'cart_view' %}" class="btn btn-light position-relative">
                🛒 Carrito
                {% if cart_count and cart_count > 0 %}
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        {{ cart_count }}
                    </span>
                {% endif %}
            </a>
        </div>
    </nav>

    <!-- Menú lateral (offcanvas) -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="menuLateral" aria-labelledby="menuLateralLabel">
        <div class="offcanvas-header" style="background-color: var(--primary-600); color: white;">
            <h5 class="offcanvas-title" id="menuLateralLabel">Menú</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
        </div>
        <div class="offcanvas-body d-flex flex-column">
            <a href="{% url 'home' %}" class="text-decoration-none mb-2">🏠 Inicio</a>
            <a href="{% url 'book_list' %}" class="text-decoration-none mb-2">📚 Catálogo</a>
            <a href="{% url 'promociones' %}" class="text-decoration-none mb-2">💥 Promociones</a>
            <a href="#" class="text-decoration-none mb-2">📦 Pedidos</a>
            <hr>
            {% if user.is_authenticated %}
                <a href="{% url 'logout' %}" class="text-decoration-none">🚪 Cerrar sesión</a>
            {% else %}
                <a href="{% url 'login' %}" class="text-decoration-none mb-2">🔐 Iniciar sesión</a>
                <a href="{% url 'signup' %}" class="text-decoration-none">📝 Registrarse</a>
            {% endif %}
        </div>
    </div>

    <!-- Contenido principal -->
    <div class="main-content-wrapper">
        <div class="content" data-aos="fade-up" data-aos-duration="700">
            {% block content %}
            {% endblock %}
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>Plataforma de digitalización de la Librería Acentos (Universidad EAFIT).</p>
    </footer>

    <!-- Chatbot -->
    {% if user.is_authenticated %}
        <link rel="stylesheet" href="{% static 'css/chatbot.css' %}">
        <div id="chatbot-fab" title="¿Necesitas ayuda?">
            🤖
        </div>
        <div id="chatbot-panel">
            <div id="chatbot-header">
                <span>Asistente Virtual</span>
                <button id="chatbot-close-btn" title="Cerrar">&times;</button>
            </div>
            <div id="chatbot-messages"></div>
            <div id="chatbot-input-area">
                <input id="chatbot-input" type="text" placeholder="Escribe tu mensaje..." autocomplete="off" />
                <button id="chatbot-send-btn">Enviar</button>
            </div>
        </div>
        <script>
        (function() {
            const fab = document.getElementById('chatbot-fab');
            const panel = document.getElementById('chatbot-panel');
            const closeBtn = document.getElementById('chatbot-close-btn');
            fab.addEventListener('click', () => panel.classList.add('open'));
            closeBtn.addEventListener('click', () => panel.classList.remove('open'));
        })();
        </script>
    {% else %}
        <link rel="stylesheet" href="{% static 'css/chatbot.css' %}">
        <div id="chatbot-fab" title="¿Necesitas ayuda?">🤖</div>
        <div id="chatbot-panel">
            <div id="chatbot-header">
                <span>Asistente Virtual</span>
                <button id="chatbot-close-btn">&times;</button>
            </div>
            <div id="chatbot-messages">
                <div class="chatbot-message bot">
                    <div class="chatbot-bubble">
                        Inicia sesión para sacar el máximo provecho de nuestra ayuda personalizada.<br>
                        <a href="{% url 'login' %}" class="btn btn-primary mt-2">Iniciar sesión</a>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if(window.AOS){
                AOS.init({once:true,offset:80,duration:700,easing:'ease-out-cubic'});
            }
        });
    </script>
</body>
</html>
